<% content_for :title, title %>

<% content_for :tab_bar do %>
  <%= render "layouts/main_tabs" %>
<% end %>

<%  # polymorphic type must be capitalize the first letter
    post_type = is_photo ? "Photo" : "Album" 
%>


<section class="px-3 pb-5 d-flex flex-wrap justify-content-around card-container">
<% if @posts.empty? %>
  <h2 class="text-muted text-uppercase"><%= t('message.no_posts') %></h2>
<% else %>

<% @posts.each do |post| %>
    <div class="post-card d-flex flex-nowrap" title="<%= t('message.click_post')%>">

        <% if is_photo %>
                <%= link_to photo_path(post), class: "post-img",  data: { turbo_frame: "modal" } do %>
                    <%= image_tag post.image_path.url, alt: t('button.photo.one'), class: "post-photo" %>
                <% end %>
        <%else%>
            <%= link_to album_path(post), class: "post-img thumbnail d-flex align-items-center", data: { turbo_frame: "albumModal" } do %>
                <%= image_tag post.photos.first.image_path.url, alt: t('button.photo.one'), class: "layer1" %>
                <%= image_tag post.photos.first.image_path.url, alt: t('button.photo.one'), class: "layer2" %>
                <%= image_tag post.photos.first.image_path.url, alt: t('button.photo.one'), class: "layer3" %>
            <% end
        end%>

        <div class="d-flex flex-column flex-wrap p-3 post-content">
            <div class="user d-flex align-items-center mb-3">
                <%= link_to profile_path(post.profile), title: "Open profile", class:"me-1 d-flex align-items-center" do %>
                    <%= image_tag post.profile.user.get_avatar, alt: t('profile.avatar'), class: "post avatar #{style_avatar(post.profile.user)} me-1" %>
                    <div class="d-flex flex-wrap">
                        <%= "#{post.profile.user.first_name} #{post.profile.user.last_name}" %>
                    </div>
                <% end %>

                <!-- In the "feeds" and "guest", not have Follow button -->
                <%if user_signed_in? && params[:tab] != "feeds"%>
                    <%= render "layouts/follow_btn", is_following: false, profile_id: post.user_id%>
                <% end %>
            </div>

            <%= simple_format(post.title, class: "truncate fs-6 fw-bold m-0 mb-4") %>

            <%= simple_format(post.description, class: "post-description m-0 truncate mb-4") %>

            <div class="post-footer mt-auto d-flex flex-wrap justify-content-between" data-controller="post">
                <div class="mb-1">
                    <% if !user_signed_in? || current_user.is_admin %>
                        <i class="fa-solid fa-heart fa-lg align-self-center me-2 heart-count"></i>
                    <% else
                        is_liked = check_favorite(current_user.profile, post, post_type)
                        icon = is_liked ? "fa-solid" : "fa-regular"
                        title_txt = is_liked ? t('message.unlike') : t('message.like')
                    %>
                    <i class="<%=icon%> fa-heart fa-lg align-self-center me-2 heart-count", title="<%= title_txt%>"
                        data-action="click->post#toggleHeart"
                        data-like-title="<%=t('message.like')%>"
                        data-unlike-title="<%= t('message.unlike') %>"
                        data-post-id = "<%= post.id%>"
                        data-post-type = "<%=post_type%>"
                        data-user-id = "<%=current_user.id%>"></i>
                    <%end%>

                    <p class="heart-count d-inline" data-post-target="heartCount">
                        <%= post.hearts_count %>
                    </p>
                </div>
                <p class="date ms-2"><%= post.updated_at.strftime("%H:%M:%S %d/%m/%Y") %></p>
            </div>

        </div>


    </div>
<% end
end  %>

</section>